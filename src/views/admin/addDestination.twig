{% extends "baseAdmin.twig" %}

{% block style %}
  <link rel="stylesheet" href="/assets/css/destinationForm.css">
{% endblock %}

{% block title %}Ajouter une destination{% endblock %}

{% block main %}
<h1>Ajouter une nouvelle destination</h1>

<form method="POST" action="/admin/destinations/add" enctype="multipart/form-data" id="destination-form">
  <label>Continent :</label>
  <select name="continent" required>
    <option value="">-- S√©lectionner un continent --</option>
    <option value="Afrique">Afrique</option>
    <option value="Am√©rique du Nord">Am√©rique du Nord</option>
    <option value="Am√©rique du Sud">Am√©rique du Sud</option>
    <option value="Asie">Asie</option>
    <option value="Europe">Europe</option>
    <option value="Oc√©anie">Oc√©anie</option>
    <option value="Antarctique">Antarctique</option>
  </select>

  <label>Titre :</label>
  <input type="text" name="titre" required>

  <label>Pays :</label>
  <input type="text" name="pays" required>

  <label for="description">Description :</label>
  <textarea id="description" name="description" required></textarea>

  <label>Image principale :</label>
  <input type="file" name="imagePrincipale" accept="image/*" required>

  <hr>

  <h2>Sections dynamiques</h2>
  <div id="sections-container"></div>

  <button type="button" onclick="addSection()">‚ûï Ajouter une section</button>
  <br><br>
  <button type="submit">‚úÖ Enregistrer la destination</button>
</form>

<script>
  let sectionIndex = 0;

  function addSection() {
    const container = document.getElementById('sections-container');
    const section = document.createElement('div');
    section.className = 'section-block';

    section.innerHTML = `
      <label>Titre de la section :</label>
      <input type="text" name="sections[${sectionIndex}][titre]" required>

      <label>Type de section :</label>
      <select name="sections[${sectionIndex}][type]" required>
        <option value="">-- S√©lectionner un type --</option>
        <option value="GUIDE">üìò GUIDE</option>
        <option value="PRESENTATION">üìÑ PR√âSENTATION</option>
        <option value="ACCES">üö™ ACC√àS</option>
        <option value="FORMALITES">üìù FORMALIT√âS</option>
        <option value="CONSEILS">üí° CONSEILS</option>
        <option value="POURQUOI">‚ùì POURQUOI Y ALLER</option>
      </select>

      <label>Contenu de la section (texte libre) :</label>
      <textarea name="sections[${sectionIndex}][contenu]" rows="4" required></textarea>

      <label>Bullet points simples :</label>
      <div class="simple-bullets-wrapper" id="simple-bullets-${sectionIndex}"></div>
      <button type="button" onclick="addSimpleBulletPoint(${sectionIndex})">‚ûï Ajouter bullet point</button>

      <div class="grouped-bullets-wrapper" id="grouped-${sectionIndex}">
        <h4>Groupes de bullet points</h4>
      </div>
      <button type="button" onclick="addGroupedBulletPoint(${sectionIndex})">‚ûï Ajouter un groupe de bullet points</button>

      <div class="images-wrapper" id="images-${sectionIndex}">
        <h4>Images associ√©es √† la section</h4>
      </div>
      <button type="button" onclick="addImage(${sectionIndex})">‚ûï Ajouter image</button>

      <button type="button" class="delete-section-btn" onclick="this.closest('.section-block').remove()">‚ùå Supprimer cette section</button>
      <hr>
    `;

    container.appendChild(section);
    sectionIndex++;
  }

  function addSimpleBulletPoint(sectionId) {
    const wrapper = document.getElementById(`simple-bullets-${sectionId}`);
    const input = document.createElement('input');
    input.type = 'text';
    input.name = `sections[${sectionId}][bulletPoints][]`;
    input.placeholder = "‚Ä¢ Texte du bullet point";
    input.required = true;
    wrapper.appendChild(input);
  }

  function addGroupedBulletPoint(sectionId) {
    const wrapper = document.getElementById(`grouped-${sectionId}`);
    const groupIndex = wrapper.querySelectorAll('.grouped-bullet-block').length;

    const group = document.createElement('div');
    group.className = 'grouped-bullet-block';
    group.innerHTML = `
      <label>Titre du groupe de bullet points :</label>
      <input type="text" name="sections[${sectionId}][groups][${groupIndex}][titre]" required>

      <div id="group-bullets-${sectionId}-${groupIndex}">
        <h5>Liste des bullet points :</h5>
      </div>
      <button type="button" onclick="addBulletPoint(${sectionId}, ${groupIndex})">‚ûï Ajouter bullet point</button>
      <hr>
    `;

    wrapper.appendChild(group);
  }

  function addBulletPoint(sectionId, groupIndex) {
    const container = document.getElementById(`group-bullets-${sectionId}-${groupIndex}`);
    const input = document.createElement('input');
    input.type = 'text';
    input.name = `sections[${sectionId}][groups][${groupIndex}][contenus][]`;
    input.placeholder = "‚Ä¢ Texte du bullet point";
    input.required = true;
    container.appendChild(input);
  }

  function addImage(sectionId) {
    const imageContainer = document.getElementById(`images-${sectionId}`);
    const input = document.createElement('input');
    input.type = 'file';
    input.name = `sections[${sectionId}][images][]`;
    input.accept = 'image/*';
    imageContainer.appendChild(input);
  }
</script>
{% endblock %}
